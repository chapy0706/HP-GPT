<!-- docs/specs/active/responsive-typography-japanese-linebreak.md -->

# 日本語テキストの不自然な改行を減らす（iPhone 13 対応）: Responsive Typography

## まず結論（難易度）
この対応は「ある程度までなら簡単」で、主に **CSSだけ**で改善できる。  
ただし「意味の連なりとして完璧に自然な改行」を自動で100%保証するのは難しい（文章内容とレイアウトに依存するため）。

今回の方針はこうする：
- **CSSで“変な折返し”を起こしにくい土台**を作る（フォントサイズ、行間、折返しルール、最大行長）
- それでも崩れる箇所は **HTMLの手動整形を最小限**だけ入れる（強制 `<br>` を減らす／必要なら `nowrap` を部分適用）

依存追加なし、ネットワーク無しで `make verify` が通る前提。

---

## 背景
iPhone 13 相当の幅（390px）で、ページ全体の日本語テキストが **不自然な箇所で改行**され、可読性が下がっている。

原因として多いのは以下：
- フォントサイズが大きすぎる / 行間や文字間が詰まりすぎる
- コンテナの幅が狭い（padding不足や max-width 不適切）
- `word-break: break-all` 等で日本語が“どこでも”分断される
- 手動の `<br>` が文脈と合わない位置に入っている
- iOSの自動テキストサイズ調整（Text Autosizing）が意図しないスケールになる

---

## ゴール
- iPhone 13 サイズでも、日本語の文章が **読みやすい行長・文字サイズ**で表示される
- 変な位置での改行（単語・意味の切れ目）を減らす
- 文字サイズを下げすぎて読みにくくなることを避ける（最小文字サイズの下限を持つ）
- 既存のイントロ演出 / 遷移 / レイアウトを破壊しない
- 依存追加なし（ネットワーク無しで `make verify` が通る）

## 非ゴール
- 日本語組版を完全自動で“意味単位”に最適化する（自動解析・形態素解析はしない）
- 全文のコピーライティング改稿

---

## 仕様（ふるまい）
### S1: ベースの文字サイズと行間（自動調整）
- `body` の基準文字サイズを **clamp** で制御する（下限・上限を持つ）
  - 例: `font-size: clamp(15.5px, 1.2vw + 12px, 18px);`
- 行間は `1.7` 前後を基準（見出しは別）
- iOSの勝手な拡大縮小を抑え、こちらのclampで調整する
  - `-webkit-text-size-adjust: 100%;`

### S2: 折返し（line break）の方針
- 日本語の改行はブラウザの禁則処理を活かす
- “どこでも切る”系は避ける
  - `word-break: normal;` を基本
  - `line-break: strict;` を基本（ブラウザ非対応なら無視されるだけでOK）
- 長いURL等の例外だけ折返し許可
  - `overflow-wrap: break-word;` を基本（必要ならリンクのみ `anywhere`）
- 可能なら “孤立1文字行” を減らす（対応ブラウザのみ効果）
  - `text-wrap: pretty;`（未対応なら無視される）

### S3: 行長（読みやすさの芯）
- 文章ブロック（説明文など）は `max-width: 42ch`〜`55ch` 程度を目安にする
  - モバイルは画面幅が支配的なので、主にPC/タブレットで効く
- 余白を確保して、狭すぎるカラムを作らない（`padding-inline` を調整）

### S4: どうしても崩れる箇所の最小補正
- 文脈上つながって見えるべき短いフレーズ（例: 「Found U」など）だけ
  - `<span class="nowrap">` を許可（多用しない）
- 文章中の不自然な `<br>` は削除して自然折返しに戻す（優先）

---

## 受け入れ条件（AC）
- AC1: iPhone 13 相当（幅 390px）で、主要な説明文が読みにくい改行になりにくい
- AC2: フォントが小さくなりすぎない（本文の下限が概ね 15px 以上）
- AC3: 長いURL等はレイアウトを突き破らずに折り返せる
- AC4: 既存のアニメーション / 遷移 / レイアウトが破壊されない
- AC5: 依存追加なしで `make verify` が通る

---

## 実装タスク
### T1: style.css（タイポグラフィ基盤）
- `:root` か `body` にタイポグラフィ変数を追加
  - `--font-base`, `--line-base`, `--measure`（max-width用）など
- 本文の基本スタイルを追加
  - `-webkit-text-size-adjust: 100%;`
  - `font-size: clamp(...);`
  - `line-height: ...;`
  - `word-break / line-break / overflow-wrap` の方針を適用
  - `text-wrap: pretty;` を可能なら追加（未対応なら無視でOK）
- 文章ブロック用のクラス（例: `.prose`）を追加し、説明文の親にだけ適用できるようにする
- `nowrap` ユーティリティ（例: `.nowrap { white-space: nowrap; }`）を追加

### T2: index.html（適用範囲を最小に）
- 文章の親要素（説明文の塊）に `.prose` を付与（全体に雑に当てない）
- `<br>` が紛れ込んでいる説明文は削除して自然折返しに戻す（必要最小限）
- どうしても崩れる短い固有名詞だけ `span.nowrap` を当てる（必要最小限）

### T3: script.js（原則変更なし）
- 文字組はCSSで対応するため、JS変更は不要

---

## Claude Code 用プロンプト（コピペ用）
目的: iPhone 13 サイズでも日本語テキストが不自然な位置で改行されにくいように、文字サイズ（clamp）と改行ルールをCSSで整えたい。依存追加は禁止（ネットワーク無しで `make verify` を通す）。影響範囲は「文章ブロック」に限定し、イントロ演出/遷移を壊さず差分最小で。

作業:
1) `/style.css` にタイポグラフィ基盤を追加（`-webkit-text-size-adjust: 100%`, `font-size: clamp(...)`, `line-height`, `word-break`, `line-break`, `overflow-wrap`。可能なら `text-wrap: pretty`）
2) 説明文の親要素にだけ適用できる `.prose` クラスを用意し、`max-width: 42ch〜55ch` と余白を調整
3) `/index.html` の説明文ブロックへ `.prose` を付与（全体に雑適用しない）
4) 不自然な `<br>` がある文章は削除して自然折返しに戻す（必要最小限）
5) どうしても崩れる固有名詞などだけ `span.nowrap` を点で適用（多用しない）
6) `make verify` を通す

注意:
- 既存の id / class を削除・改名しない
- ついでリファクタ禁止
- 影響範囲は文章ブロック中心に限定（レイアウト全体を崩さない）
